<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="RGCA">
<title>Simple Application of RGCA â€¢ RGCA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simple Application of RGCA">
<meta property="og:description" content="RGCA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RGCA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/RGCA_manuscript.html">RGCA Manuscript Pipeline</a>
    <a class="dropdown-item" href="../articles/Simple_Application.html">Simple Application of RGCA</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NIEHS/RGCA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simple Application of RGCA</h1>
                        <h4 data-toc-skip class="author">Daniel
Zilber</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NIEHS/RGCA/blob/HEAD/vignettes/articles/Simple_Application.Rmd" class="external-link"><code>vignettes/articles/Simple_Application.Rmd</code></a></small>
      <div class="d-none name"><code>Simple_Application.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="simple-usage-of-rgca">Simple Usage of RGCA<a class="anchor" aria-label="anchor" href="#simple-usage-of-rgca"></a>
</h2>
<p>While the method could be generalize to a variety of smooth, monotone
dose response functions, our package is designed around the Hill
function, <span class="math display">\[f(x|a,b,c) =
\frac{a}{1+\left(\frac{b}{x}\right)^{c}}\]</span> The parameters are the
sill (a), the EC50 (b), and the slope (c). Give these parameters and a
cluster assignment vector, RGCA can create a calculator that predicts
the mixture response given an input dose vector <span class="math inline">\((x_1,...,x_n)\)</span>. In the example below,
there are three chemicals with known Hill parameters.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_chems</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">sills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">ec50_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.75</span>, <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="va">slopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">1.1</span>, <span class="fl">2.0</span><span class="op">)</span></span>
<span><span class="co"># Rmax is used to scale IA across clusters, can copy sills</span></span>
<span><span class="va">param_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="va">sills</span>,</span>
<span>                                <span class="st">"b"</span> <span class="op">=</span> <span class="va">ec50_vec</span>,</span>
<span>                                <span class="st">"c"</span> <span class="op">=</span> <span class="va">slopes</span>,</span>
<span>                                <span class="st">"max_R"</span> <span class="op">=</span> <span class="va">sills</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The cluster assignment vector is used to group the chemicals by
similarity. If two chemicals are in the same group, they are assumed to
be equivalent after adjusting for potency. If all chemicals are added to
one group via, the prediction is equivalent to concentration additon
(AKA dose addition, Loewe Additivity). If all chemicals are added to
separate groups, the prediction is equivalent to independent action (AKA
response addition, Bliss independence).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example 1: concentration addition </span></span>
<span><span class="va">cluster_assign_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Example 2: independent action</span></span>
<span><span class="va">cluster_assign_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># A random cluster</span></span>
<span><span class="va">cluster_assign_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># create a calculator to predict response given concentration</span></span>
<span><span class="va">mix_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mix_function_generator.html">mix_function_generator</a></span><span class="op">(</span><span class="va">param_matrix</span>, <span class="va">cluster_assign_vec</span><span class="op">)</span></span></code></pre></div>
<p>To create a mixture, we need to specify the concentration of each
chemical.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate mix concentrations:  each row of the matrix is one dose of the mix</span></span>
<span><span class="va">n_samps</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="co"># equipotent mixture: concentrations scaled by EC50</span></span>
<span><span class="va">equipot_conc_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">n_samps</span>, ncol <span class="op">=</span> <span class="va">n_chems</span><span class="op">)</span></span>
<span><span class="co"># equimolar mixture: equal concentration of all chemicals</span></span>
<span><span class="va">equimol_conc_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">n_samps</span>, ncol <span class="op">=</span> <span class="va">n_chems</span><span class="op">)</span></span>
<span><span class="co"># generate concentrations on the log scale</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">chem_idx</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_chems</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">equipot_conc_matrix</span><span class="op">[</span>, <span class="va">chem_idx</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">ec50_vec</span><span class="op">[</span><span class="va">chem_idx</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n_samps</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">equimol_conc_matrix</span><span class="op">[</span>, <span class="va">chem_idx</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n_samps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#create the mixture concentration vector for plotting</span></span>
<span><span class="va">equipot_conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">equipot_conc_matrix</span><span class="op">)</span></span>
<span><span class="va">equimol_conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">equimol_conc_matrix</span><span class="op">)</span></span>
<span><span class="co"># Apply the pediction function to the concentrations of interest</span></span>
<span><span class="va">pred_equipot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">equipot_conc_matrix</span>,</span>
<span>                      MARGIN <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">mix_pred</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_equimol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">equimol_conc_matrix</span>,</span>
<span>                      MARGIN <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">mix_pred</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can plot the two predicted mixture responses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">equimol_conc</span>, <span class="va">pred_equimol</span>, log <span class="op">=</span> <span class="st">"x"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">equipot_conc</span>, <span class="va">pred_equimol</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simple_Application_files/figure-html/unnamed-chunk-3-1.png" width="700">
## Fitting Dose Response Curves In the example above, we assume the
parameters are known. If you have raw data for the individual chemical
dose responses and want to fit the random effect model that we describe
in our manuscript, the RGCA package has a built-in Bayesian MCMC fitting
routing. Our function is designed to fit the Hill model described
earlier with random effects (u, v) for the replicates: <span class="math display">\[f(x |a,b,c) = \frac{a +
u}{1+\left(\frac{b}{x}\right)^{c}}+ v + \epsilon\]</span> The random
effects allow for the replicates to have different responses by either
adjusting the maximum effect (u) or by adjusting the minimum effect (v).
Three pieces of data are needed: the responses, the doses, and a list of
the replicates. We will sample curves using the specified
parameters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">replicate_sets</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n_repls</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">replicate_sets</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">doses</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span> <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">3</span>, length.out <span class="op">=</span> <span class="va">n_samps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Cx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">doses</span>, nrow <span class="op">=</span> <span class="va">n_repls</span>, ncol <span class="op">=</span> <span class="va">n_samps</span>, byrow <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># specify which rows of the data will correspond to which parameter</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">n_repls</span>, ncol <span class="op">=</span> <span class="va">n_samps</span><span class="op">)</span></span>
<span><span class="co">#iterate over the parameter sets</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">rep_idx</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">replicate_sets</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># iterate over replicates</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">row_idx</span> <span class="kw">in</span> <span class="va">replicate_sets</span><span class="op">[[</span><span class="va">rep_idx</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">hill_params</span> <span class="op">&lt;-</span> <span class="va">param_matrix</span><span class="op">[</span><span class="va">rep_idx</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="co"># add random effect for sill</span></span>
<span>    <span class="va">samp_sd_u</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">row_idx</span> <span class="op">==</span> <span class="va">replicate_sets</span><span class="op">[[</span><span class="va">rep_idx</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">hill_params</span><span class="op">[[</span><span class="st">'a'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">hill_params</span><span class="op">[[</span><span class="st">'a'</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, sd<span class="op">=</span><span class="va">samp_sd_u</span><span class="op">)</span></span>
<span>    <span class="va">data</span><span class="op">[</span><span class="va">row_idx</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">doses</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">hill_function</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">hill_params</span>, conc <span class="op">=</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># now we add iid noise to simulate observations</span></span>
<span><span class="va">noisy_data</span> <span class="op">=</span> <span class="va">data</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p>The output is plotted and looks reasonable.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">doses</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, log <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">doses</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">noisy_data</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"p"</span>,add <span class="op">=</span> <span class="cn">T</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simple_Application_files/figure-html/plot%20data-1.png" width="700">
Now we can run our custom MCMC script to fit the data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RE_mcmc_chains</span> <span class="op">=</span> <span class="fu"><a href="../reference/RE_MCMC_fit.html">RE_MCMC_fit</a></span><span class="op">(</span>y_i <span class="op">=</span> <span class="va">noisy_data</span>,</span>
<span>            Cx <span class="op">=</span> <span class="va">Cx</span>,</span>
<span>            replicate_sets <span class="op">=</span> <span class="va">replicate_sets</span><span class="op">)</span></span></code></pre></div>
<p>We use a helper function to extract the relevant parameters and
compare to the true parameters.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RE_params</span> <span class="op">=</span> <span class="fu"><a href="../reference/pull_summary_parameters.html">pull_summary_parameters</a></span><span class="op">(</span><span class="va">RE_mcmc_chains</span>, summry_stat <span class="op">=</span> <span class="va">median</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">RE_params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $sill_params</span></span>
<span><span class="co">## [1] 3.039055 4.997729 3.947410</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sill_sd</span></span>
<span><span class="co">## [1] 0.07896465 0.06644112 0.06192497</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ec50_params</span></span>
<span><span class="co">## [1] 1.0168967 0.7195774 2.3454213</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ec50_stdev</span></span>
<span><span class="co">## [1] 0.16024360 0.04082689 0.09366453</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $u_RE_params</span></span>
<span><span class="co">## [1]  0.00000000 -0.37343283 -0.11834004  0.00000000  1.64234934  0.00000000</span></span>
<span><span class="co">## [7]  0.01136244  0.17092552</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $v_RE_params</span></span>
<span><span class="co">## [1]  0.00000000 -0.13420422 -0.13471061  0.00000000 -0.10752350  0.00000000</span></span>
<span><span class="co">## [7]  0.07774817  0.04011637</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $u_RE_sd_params</span></span>
<span><span class="co">## [1] 0.5009757 2.1398733 0.3794902</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $v_RE_sd_params</span></span>
<span><span class="co">## [1] 0.3948315 0.5540349 0.3663125</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $slope_params</span></span>
<span><span class="co">## [1] 0.6551344 1.0399488 2.3618687</span></span></code></pre>
<p>Note that in addition to extracting the point estimates of the
parameters (using the median by default), the standard deviations are
also extracted. They are not used here, but can provide uncertainty
quantification by sampling values and plotting the resulting curves.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitted_params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="va">RE_params</span><span class="op">$</span><span class="va">sill_params</span>,</span>
<span>                                <span class="st">"b"</span> <span class="op">=</span> <span class="va">RE_params</span><span class="op">$</span><span class="va">ec50_params</span>,</span>
<span>                                <span class="st">"c"</span> <span class="op">=</span> <span class="va">RE_params</span><span class="op">$</span><span class="va">slope_params</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">u_pars</span> <span class="op">=</span> <span class="va">RE_params</span><span class="op">$</span><span class="va">u_RE_params</span></span>
<span><span class="va">v_pars</span> <span class="op">=</span> <span class="va">RE_params</span><span class="op">$</span><span class="va">v_RE_params</span></span>
<span><span class="va">pred_data</span> <span class="op">=</span> <span class="va">data</span><span class="op">*</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">rep_idx</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">replicate_sets</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># iterate over replicates</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">row_idx</span> <span class="kw">in</span> <span class="va">replicate_sets</span><span class="op">[[</span><span class="va">rep_idx</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">hill_params</span> <span class="op">&lt;-</span> <span class="va">fitted_params</span><span class="op">[</span><span class="va">rep_idx</span>,<span class="op">]</span></span>
<span>    <span class="co"># add random effect for sill</span></span>
<span>    <span class="va">hill_params</span><span class="op">[[</span><span class="st">'a'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">hill_params</span><span class="op">[[</span><span class="st">'a'</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">u_pars</span><span class="op">[</span><span class="va">row_idx</span><span class="op">]</span></span>
<span>    <span class="va">pred_data</span><span class="op">[</span><span class="va">row_idx</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">Cx</span><span class="op">[</span><span class="va">rep_idx</span>,<span class="op">]</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">hill_function</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">hill_params</span>, conc <span class="op">=</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op">+</span> <span class="va">v_pars</span><span class="op">[</span><span class="va">row_idx</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">doses</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pred_data</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, log <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">doses</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">noisy_data</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"p"</span>,add <span class="op">=</span> <span class="cn">T</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simple_Application_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Zilber, Kyle Messier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
